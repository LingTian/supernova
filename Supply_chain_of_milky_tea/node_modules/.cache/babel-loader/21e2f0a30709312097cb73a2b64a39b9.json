{"remainingRequest":"/home/hong/code/Supply_chain_of_milky_tea/node_modules/babel-loader/lib/index.js!/home/hong/code/Supply_chain_of_milky_tea/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/hong/code/Supply_chain_of_milky_tea/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/hong/code/Supply_chain_of_milky_tea/src/components/Voting.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/hong/code/Supply_chain_of_milky_tea/src/components/Voting.vue","mtime":1564828008616},{"path":"/home/hong/code/Supply_chain_of_milky_tea/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/hong/code/Supply_chain_of_milky_tea/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/hong/code/Supply_chain_of_milky_tea/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/hong/code/Supply_chain_of_milky_tea/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.sort\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/home/hong/code/Supply_chain_of_milky_tea/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _require = require(\"u3.js\"),\n    createU3 = _require.createU3,\n    U3Utils = _require.U3Utils;\n\nvar config = require(\"../../config\");\n\nexport default {\n  name: \"Voting\",\n  data: function data() {\n    return {\n      candidate: \"\",\n      voteFormShow: false,\n      votes: [],\n      candidates: [],\n      voterName: \"\",\n      privateKey: \"\",\n      showLoading: false\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    var func =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var account, u3, canditable, candiscope, candidates, votestable, votesscope, votes;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                account = \"ben\";\n                u3 = createU3(config);\n                canditable = \"candidate\";\n                candiscope = \"s.candidate\";\n                _context.next = 6;\n                return u3.getTableRecords({\n                  \"json\": true,\n                  \"code\": account,\n                  \"scope\": candiscope,\n                  \"table\": canditable\n                });\n\n              case 6:\n                candidates = _context.sent;\n                _this.candidates = candidates.rows;\n                votestable = \"votes\";\n                votesscope = \"s.votes\";\n                _context.next = 12;\n                return u3.getTableRecords({\n                  \"json\": true,\n                  \"code\": account,\n                  \"scope\": votesscope,\n                  \"table\": votestable\n                });\n\n              case 12:\n                votes = _context.sent;\n                _this.votes = votes.rows.sort(_this.compare);\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function func() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    func();\n  },\n  methods: {\n    goToVote: function goToVote() {\n      this.voteFormShow = true;\n    },\n    compare: function compare(a, b) {\n      var comparison = 0;\n\n      if (a.count > b.count) {\n        comparison = -1;\n      } else if (b.count > a.count) {\n        comparison = 1;\n      }\n\n      return comparison;\n    },\n    vote: function () {\n      var _vote = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3() {\n        var _this2 = this;\n\n        var creator, u3, contract, result, timeout, finalResult;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!this.candidate) {\n                  _context3.next = 24;\n                  break;\n                }\n\n                creator = \"ben\";\n                config.keyProvider = this.privateKey;\n                u3 = createU3(config);\n                _context3.next = 6;\n                return u3.contract(creator);\n\n              case 6:\n                contract = _context3.sent;\n                _context3.next = 9;\n                return contract.vote(this.candidate, {\n                  authorization: this.voterName + \"@active\"\n                });\n\n              case 9:\n                result = _context3.sent;\n                this.showLoading = true; // first check whether the transaction was failed\n\n                if (!(!result || result.processed.receipt.status !== \"executed\")) {\n                  _context3.next = 15;\n                  break;\n                }\n\n                //console.log(\"the transaction was failed\");\n                alert(\"Voted failed\");\n                this.showLoading = false;\n                return _context3.abrupt(\"return\");\n\n              case 15:\n                // then check whether the transaction was irreversible when it was not expired\n                timeout = new Date(result.transaction.transaction.expiration + \"Z\") - new Date();\n                finalResult = false;\n                _context3.prev = 17;\n                _context3.next = 20;\n                return U3Utils.test.waitUntil(\n                /*#__PURE__*/\n                _asyncToGenerator(\n                /*#__PURE__*/\n                regeneratorRuntime.mark(function _callee2() {\n                  var tx;\n                  return regeneratorRuntime.wrap(function _callee2$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          _context2.next = 2;\n                          return u3.getTxByTxId(result.transaction_id);\n\n                        case 2:\n                          tx = _context2.sent;\n                          finalResult = tx && tx.irreversible;\n\n                          if (!finalResult) {\n                            _context2.next = 9;\n                            break;\n                          }\n\n                          _this2.showLoading = false;\n                          alert(\"Voted success\");\n                          document.location.reload();\n                          return _context2.abrupt(\"return\", true);\n\n                        case 9:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _callee2);\n                })), timeout, 1000);\n\n              case 20:\n                _context3.next = 24;\n                break;\n\n              case 22:\n                _context3.prev = 22;\n                _context3.t0 = _context3[\"catch\"](17);\n\n              case 24:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[17, 22]]);\n      }));\n\n      function vote() {\n        return _vote.apply(this, arguments);\n      }\n\n      return vote;\n    }()\n  }\n};",{"version":3,"sources":["Voting.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"main\">\n        <h1>Voting Result</h1>\n        <table border=\"1\">\n            <thead>\n            <tr>\n                <th>NO.</th>\n                <th>Candidate</th>\n                <th>Count</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr v-bind:key=\"v.name\" v-for=\"(v,index) in votes\">\n                <td>{{index+1}}</td>\n                <td>{{v.name}}</td>\n                <td>{{v.count}}</td>\n            </tr>\n            </tbody>\n        </table>\n        <h4>All candidates</h4>\n        <div class=\"form-inline\">\n            <select v-model=\"candidate\">\n                <option value=\"\">Choose a candidate</option>\n                <option v-bind:key=\"c.name\" v-for=\"c in candidates\">{{c.name}}</option>\n            </select>\n        </div>\n\n        <div class=\"go-to-vote\" @click=\"goToVote()\">Start voting</div>\n        <div class=\"vote-form\" v-show=\"voteFormShow\">\n            <div class=\"form-inline\">\n                <label>Voter</label><input v-model=\"voterName\"/>\n            </div>\n            <div class=\"form-inline\">\n                <label>PrivateKey</label><input v-model=\"privateKey\"/>\n            </div>\n            <button :disabled=\"showLoading\" v-show=\"candidate\" class=\"vote-btn\" @click=\"vote()\">{{\n                showLoading?\"waiting...\":\"Send votes\" }}\n            </button>\n        </div>\n    </div>\n</template>\n\n<script>\n  const { createU3, U3Utils } = require(\"u3.js\");\n  const config = require(\"../../config\");\n  export default {\n    name: \"Voting\",\n    data() {\n      return {\n        candidate: \"\",\n        voteFormShow: false,\n        votes: [],\n        candidates: [],\n        voterName: \"\",\n        privateKey: \"\",\n        showLoading: false\n      };\n    },\n    mounted() {\n      let func = async () => {\n        let account = \"ben\";\n        const u3 = createU3(config);\n        const canditable = \"candidate\";\n        const candiscope = \"s.candidate\";\n        let candidates = await u3.getTableRecords({\n          \"json\": true,\n          \"code\": account,\n          \"scope\": candiscope,\n          \"table\": canditable\n        });\n        this.candidates = candidates.rows;\n\n        const votestable = \"votes\";\n        const votesscope = \"s.votes\";\n        let votes = await u3.getTableRecords({\n          \"json\": true,\n          \"code\": account,\n          \"scope\": votesscope,\n          \"table\": votestable\n        });\n        this.votes = votes.rows.sort(this.compare);\n      };\n      func();\n    },\n    methods: {\n      goToVote() {\n        this.voteFormShow = true;\n      },\n      compare(a, b) {\n        let comparison = 0;\n        if (a.count > b.count) {\n          comparison = -1;\n        } else if (b.count > a.count) {\n          comparison = 1;\n        }\n        return comparison;\n      },\n      async vote() {\n        if (this.candidate) {\n          let creator = \"ben\";\n          config.keyProvider = this.privateKey;\n          const u3 = createU3(config);\n          let contract = await u3.contract(creator);\n          let result = await contract.vote(this.candidate, { authorization: this.voterName + \"@active\" });\n          this.showLoading = true;\n\n          // first check whether the transaction was failed\n          if (!result || result.processed.receipt.status !== \"executed\") {\n            //console.log(\"the transaction was failed\");\n            alert(\"Voted failed\");\n            this.showLoading = false;\n            return;\n          }\n\n          // then check whether the transaction was irreversible when it was not expired\n          let timeout = new Date(result.transaction.transaction.expiration + \"Z\") - new Date();\n          let finalResult = false;\n          try {\n            await U3Utils.test.waitUntil(async () => {\n              let tx = await u3.getTxByTxId(result.transaction_id);\n              finalResult = tx && tx.irreversible;\n              if (finalResult) {\n                this.showLoading = false;\n                alert(\"Voted success\");\n                document.location.reload();\n\n                return true;\n              }\n            }, timeout, 1000);\n          } catch (e) {\n            //console.log(finalResult);\n          }\n\n        }\n      }\n    }\n  };\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n    .main {\n        text-align: left;\n        padding: 0 40%;\n    }\n\n    .go-to-vote, .vote-btn {\n        margin: 30px 0;\n        padding: 3px 8px;\n        width: 100px;\n        border: 1px solid rgba(177, 177, 177, 0.85);\n        -webkit-border-radius: 5px;\n        -moz-border-radius: 5px;\n        border-radius: 5px;\n        cursor: pointer;\n    }\n\n    .vote-form .form-inline {\n        display: inline-block;\n        margin: 5px 0;\n    }\n\n    .vote-form .form-inline label {\n        width: 75px;\n        display: inline-block;\n    }\n</style>\n"],"sourceRoot":"src/components"}]}